
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Genesys Subscribe (Inbound Only)</title>
  <style>
    #incomingBox { width: 100%; height: 160px; }
  </style>
</head>
<body>
  <h3>Send a Message</h3>
  <input id="msgInput" type="text" placeholder="Type your message">
  <button onclick="sendMessage()">Send</button>

  <h3>Incoming Text</h3>
  <textarea id="incomingBox" readonly placeholder="Inbound text will appear here"></textarea>

  <script>
    // Load Genesys Web Messenger (adjust env/deploymentId if needed)
    (function (g, e, n, es, ys) {
      g['_genesysJs'] = e;
      g[e] = g[e] || function () { (g[e].q = g[e].q || []).push(arguments); };
      g[e].t = 1 * new Date();
      g[e].c = es;
      ys = document.createElement('script');
      ys.async = 1;
      ys.src = n;
      ys.charset = 'utf-8';
      document.head.appendChild(ys);
    })(window, 'Genesys', 'https://apps.mypurecloud.jp/genesys-bootstrap/genesys.min.js', {
      environment: 'prod-apne1',
      deploymentId: 'be7b456d-7625-4f4f-83b3-ed30ebf47cc2'
    });

    function appendIncoming(line) {
      const box = document.getElementById('incomingBox');
      box.value += (box.value ? "\n" : "") + line;
      box.scrollTop = box.scrollHeight;
    }

    function sendMessage() {
      const text = document.getElementById('msgInput').value.trim();
      if (!text) return;
      Genesys("command", "MessagingService.sendMessage", { message: text });
      document.getElementById('msgInput').value = "";
    }

    // Subscribe and append only **Inbound** messages
    Genesys("subscribe", "MessagingService.messagesReceived", function({ data }) {
      const msgs = Array.isArray(data?.messages) ? data.messages : [];
      msgs.forEach(m => {
        const direction = m?.channel?.direction; // "Inbound" or "Outbound"
        const text = m?.text;

        // Only show agent/bot/system inbound messages
        if (direction === "Inbound" && typeof text === "string" && text.length > 0) {
          appendIncoming("Genesys: " + text);
        }
      });
    });
  </script>
</</body>
