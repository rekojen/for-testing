
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Genesys Subscribe (Text Only)</title>
  <style>
    #incomingBox { width: 100%; height: 160px; }
  </style>
  <button onclick="subscribeMessages()">Start Listening</button></head>

  <h3>Incoming Text</h3>
  <textarea id="incomingBox" readonly placeholder="Inbound text will appear here"></textarea>

  <script>
    // Load Genesys Web Messenger (adjust env/deploymentId if needed)
    (function (g, e, n, es, ys) {
      g['_genesysJs'] = e;
      g[e] = g[e] || function () { (g[e].q = g[e].q || []).push(arguments); };
      g[e].t = 1 * new Date();
      g[e].c = es;
      ys = document.createElement('script');
      ys.async = 1;
      ys.src = n;
      ys.charset = 'utf-8';
      document.head.appendChild(ys);
    })(window, 'Genesys', 'https://apps.mypurecloud.jp/genesys-bootstrap/genesys.min.js', {
      environment: 'prod-apne1',
      deploymentId: 'be7b456d-7625-4f4f-83b3-ed30ebf47cc2'
    });

    function append(line) {
      const box = document.getElementById('incomingBox');
      box.value += (box.value ? "\n" : "") + line;
      box.scrollTop = box.scrollHeight; // auto-scroll
    }

    // Button handler: subscribe and append only message.text
    function subscribeMessages() {
      Genesys("subscribe", "MessagingService.messagesReceived", function({ data }) {
        const msgs = Array.isArray(data?.messages) ? data.messages : [];
        msgs.forEach(m => {
          // Only append the text field if present
          if (typeof m?.text === 'string' && m.text.length > 0) {
            append(m.text);
          }
        });
      });
      append("Listening for incoming textâ€¦");
    }
   </script>
</body>

<body>
  <h3>Subscribe to Messages</h3>
